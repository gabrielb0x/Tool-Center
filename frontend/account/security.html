<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool center - Mes Tools</title>
    <link rel="icon" href="/assets/tc_logo.webp" type="image/png">
    <link rel="stylesheet" href="/src/CSS/account/security.css">
    <link rel="preload" href="/assets/switcher-noir.png" as="image">
</head>
<body>
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <h2 class="auth-title">Connectez-vous</h2>
            <p class="auth-message">Vous devez être connecté pour accéder à cette page. Veuillez vous connecter ou créer un compte.</p>
            <div class="auth-buttons">
                <a href="/signin" class="auth-btn auth-btn-primary">Se connecter</a>
                <a href="/signup" class="auth-btn auth-btn-secondary">Créer un compte</a>
            </div>
        </div>
    </div>

    <div class="main-content-container" id="mainContentContainer">
        <header id="mainHeader">
            <div class="left-header">
                <a href="https://tool-center.fr" class="logo-link">
                    <img src="/assets/tc_logo.webp" alt="ToolCenter Logo" class="logo">
                    <span class="site-title">ToolCenter</span>
                </a>
            </div>
            <div class="right-header">
                <button class="theme-switcher" id="theme-switcher">
                    <img src="/assets/switcher.png" alt="Changer de thème" class="theme-icon" id="theme-icon">
                </button>
            </div>
        </header>

        <div class="container" id="mainContainer">
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">Navigation</h3>
                </div>
                <ul class="sidebar-menu">
                    <li>
                        <a href="/account">
                            <img src="/assets/account.png" alt="Informations" class="sidebar-icon">
                            Informations du compte
                        </a>
                    </li>
                    <li>
                        <a href="/account/tools">
                            <img src="/assets/code.png" alt="Tools" class="sidebar-icon">
                            Tools Publiés
                        </a>
                    </li>
                    <li>
                        <a href="/account/security" class="active">
                            <img src="/assets/security-icon.png" alt="Sécurité" class="sidebar-icon">
                            Sécurité
                        </a>
                    </li>
                    <li>
                        <a href="/account/preferences">
                            <img src="/assets/preferences-icon.png" alt="Préférences" class="sidebar-icon">
                            Préférences
                        </a>
                    </li>
                    <li>
                        <a href="/account/confidentiality">
                            <img src="/assets/privacy-icon.png" alt="Confidentialité" class="sidebar-icon">
                            Confidentialité
                        </a>
                    </li>
                    <li>
                        <a href="/account/notifications">
                            <img src="/assets/newsletter.png" alt="Notifications" class="sidebar-icon">
                            Notifications
                        </a>
                    </li>
                    <li>
                        <a href="/account/logout">
                            <img src="/assets/logout.png" alt="Notifications" class="sidebar-icon">
                            Se déconnecter
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="main-content">
                <div class="tools-header">
                    <div>
                        <h1 class="tools-title">Sécurité du compte</h1>
                        <p class="tools-subtitle">Gérez la sécurité de votre compte ToolCenter</p>
                    </div>
                </div>

                <div id="errorContainer" class="hidden"></div>

                <div class="security-sections">
                    <div class="security-section">
                        <h3 class="security-section-title">
                            <img src="/assets/security-icon.png" alt="Authentification" class="security-icon">
                            Authentification
                        </h3>
                        <div class="security-options">
                            <div class="security-option">
                                <div class="security-option-info">
                                    <h4>Changer l'email</h4>
                                    <p>Mettez à jour l'adresse email associée à votre compte</p>
                                </div>
                                <button class="security-btn" id="changeEmailBtn">
                                    <img src="/assets/edit-icon.png" alt="Modifier" class="security-btn-icon">
                                    Modifier
                                </button>
                            </div>
                            <div class="security-option">
                                <div class="security-option-info">
                                    <h4>Changer le mot de passe</h4>
                                    <p>Mettez à jour votre mot de passe pour plus de sécurité</p>
                                </div>
                                <button class="security-btn" id="changePasswordBtn">
                                    <img src="/assets/password.png" alt="Modifier" class="security-btn-icon">
                                    Modifier
                                </button>
                            </div>
                            <div class="security-option">
                                <div class="security-option-info">
                                    <h4>Authentification à deux facteurs</h4>
                                    <p>Ajoutez une couche de sécurité supplémentaire avec Google Authenticator</p>
                                </div>
                                <button class="security-btn" id="enable2faBtn">
                                    <img src="/assets/password.png" alt="Activer" class="security-btn-icon">
                                    Activer
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="security-section">
                        <h3 class="security-section-title">
                            <img src="/assets/sessions-icon.png" alt="Sessions" class="security-icon">
                            Sessions actives
                        </h3>
                        <div class="sessions-list" id="sessionsList">
                            <div class="session-item skeleton" id="skeletonSession">
                                <div class="session-info">
                                    <div class="session-device">
                                        <div class="skeleton skeleton-device-icon" style="width:24px;height:24px;border-radius:50%;"></div>
                                        <div style="flex:1;">
                                            <div class="skeleton skeleton-text" style="width:70%;height:20px;margin-bottom:8px;"></div>
                                            <div class="skeleton skeleton-text" style="width:50%;height:16px;"></div>
                                        </div>
                                    </div>
                                    <div class="skeleton skeleton-text" style="width:80px;height:20px;border-radius:12px;"></div>
                                </div>
                                <div class="skeleton skeleton-button" style="width:32px;height:32px;"></div>
                            </div>
                        </div>
                        <button class="logout-all-btn" id="logoutAllBtn">
                            <img src="/assets/logout.png" alt="Déconnecter" class="logout-all-icon">
                            Déconnecter toutes les sessions
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="emailModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Modifier mon email</h3>
                <button class="modal-close" id="closeEmailModal">
                    <img src="/assets/croix.png" alt="Fermer" class="modal-close-icon">
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newEmail" class="form-label">Nouvel email</label>
                    <input type="email" id="newEmail" class="form-input" placeholder="nouvel@email.com">
                </div>
                <div class="form-group">
                    <label for="currentEmailPassword" class="form-label">Mot de passe actuel</label>
                    <input type="password" id="currentEmailPassword" class="form-input" placeholder="Mot de passe">
                </div>
                <div class="form-group" id="email2FAGroup" style="display:none;">
                    <label for="email2FACode" class="form-label">Code 2FA</label>
                    <input type="text" id="email2FACode" class="form-input" maxlength="6" placeholder="123456">
                </div>
                <div id="emailError" class="error-message" style="display:none;">
                    <img src="/assets/error.png" alt="Erreur" class="error-icon">
                    <span id="emailErrorText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEmailModal">Annuler</button>
                <button class="btn btn-primary" id="confirmEmailModal">Valider</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Modifier mon mot de passe</h3>
                <button class="modal-close" id="closePasswordModal">
                    <img src="/assets/croix.png" alt="Fermer" class="modal-close-icon">
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentPassword" class="form-label">Mot de passe actuel</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="Mot de passe actuel">
                </div>
                <div class="form-group">
                    <label for="newPassword" class="form-label">Nouveau mot de passe</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="Nouveau mot de passe">
                </div>
                <div class="form-group">
                    <label for="confirmPassword" class="form-label">Confirmer le mot de passe</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="Confirmer">
                </div>
                <div class="form-group" id="password2FAGroup" style="display:none;">
                    <label for="password2FACode" class="form-label">Code 2FA</label>
                    <input type="text" id="password2FACode" class="form-input" maxlength="6" placeholder="123456">
                </div>
                <div id="passwordError" class="error-message" style="display:none;">
                    <img src="/assets/error.png" alt="Erreur" class="error-icon">
                    <span id="passwordErrorText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPasswordModal">Annuler</button>
                <button class="btn btn-primary" id="confirmPasswordModal">Valider</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="twoFAModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Activer l'authentification à deux facteurs</h3>
                <button class="modal-close" id="close2FAModal">
                    <img src="/assets/croix.png" alt="Fermer" class="modal-close-icon">
                </button>
            </div>
            <div class="modal-body">
                <p>Scannez ce QR Code avec votre application d'authentification puis entrez le code généré.</p>
                <div id="qrCodeContainer" style="text-align:center;margin:20px 0;"></div>
                <input type="text" id="twoFACodeInput" class="form-input" placeholder="Code 2FA">
                <div id="twoFAError" class="error-message" style="display:none;margin-top:10px;">
                    <img src="/assets/error.png" alt="Erreur" class="error-icon">
                    <span id="twoFAErrorText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel2FAModal">Annuler</button>
                <button class="btn btn-primary" id="confirm2FAModal">Valider</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="/src/utils/config.js"></script>
    <script type="module" src="/src/JS/account/security.js"></script>
</body>
</html>